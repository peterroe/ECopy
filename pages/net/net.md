HTTP发展历史

* 1991，HTTP/0.9问世，只支持GET方法，没有首部，只能获取纯文本
* 1996，HTTP/1.0问世，增加了首部、状态码、权限、缓存、长连接（默认短连接） 
  * GET、POST、HEAD方法
  * Last-Modified/If-Modified-Since 和Expires作为标识
* 1997，HTTP/1.1问世，默认长连接、管线化、Cache-Control、Etag等扩展 
  * PUT、PATCH、DELETE、OPTIONS、TRACE、CONNECT方法
  * 强化了缓存控制

长连接

在一个TCP上可以串行发送多个HTTP请求而无需断开

HTTP1.1的问题

* 队头阻塞，TCP连接上只能发送一个HTTP请求，前面未完成，后续的都在等待 
  * 虽然管线化可以支持并发请求，但是浏览器很难实现，所以目前都是依赖于多个TCP连接，一个域名最多支持6-8个
  * 域名分片，多准备几个二级域名，不同的资源指向不同的域名，而域名都指向同一台服务器
* 采用文本格式，头部冗余，首部未压缩，每次请求都会带上大部分相同的首部

什么是管线化

HTTP1.1在使用长连接的情况下， 建立一个连接后：

请求1 、 响应1、请求2、响应2、请求3、响应3

管线化后：

请求1、请求2、请求3、响应1、响应2、响应3

* 在HTTP1.1支持
* 只有GET请求和HEAD请求才支持
* 响应顺序参考请求顺序
* 要求客户端和服务端都执行管线化
* 浏览器支持不友好

HTTP2.0

https://img-blog.csdnimg.cn/c8afe29ce63e4a33bc7d2315e93c741f.webp

*  二进制分帧层 
  * 1.1是文本格式，2.0是二进制格式，缩小了体积
  * 划分为两个帧来传输（HEADERS frame、DATA frame）
*  多路复用 
  * 让所有的HTTP通信都在一个TCP连接上完成
  * 一个连接上面有多个流（单链接双向数据流），流之间互不影响，帧传输过去以后，再进行重组
*  首部压缩 
  * 维护一份相同的静态字典，包含常见的头部名称，以及常见头部名称和值的组合（method:GET）
  * 维护一份相同的动态字典（user-agent、cookie）
  * 通过哈夫曼对首部字段进行编码
*  服务端推送 
  * 服务端除了向客户端返回响应消息之外，还可以额外返回其他资源，例如返回HTML文件时候，服务器能够推送script和css文件 
    ■ 服务端通过分析这个资源依赖的其他资源，主动推送到客户端。当客户端需要时，资源已经位于缓存
*  流传输 
  * 得益于二进制分帧，解决队头阻塞问题

HTTP代理

* 普通人代理（中间人代理） 
  * 对于客户端来说，扮演服务器
  * 对于服务器来说，扮演客户端
* 隧道代理 
  * 客户端通过CONNECT方法请求隧道代理，创建一个可以到任意目标服务器和端口号的TCP连接
  * 创建隧道代理之后，只做请求和响应的转发

代理服务器的好处

* VPN翻墙
* 隐藏自己的IP，对非法IP限制
* 负载均衡，通过随机算法，hash，轮询，lru，对资源合理分配

正向代理

* 抓包工具、VPN
* 屏蔽某些网站，拦截广告

反向代理

* NGINX

HTTP3.0

* HTTP2.0解决了HTTP的队头阻塞，但是还有TCP队头阻塞
* HTTP2.0的多路复用对TCP不管用，TCP在丢包的时候会进行重传，前面有一个包没收到，就只能把后面的包放到缓冲区

优点

* 用UDP代替TCP
* 实现了一套新的拥塞控制算法，解决了队头阻塞的问题
* 虽然基于UDP，但是也提供了类似TCP的流量控制，传输可靠性功能。数据包重传、拥塞控制

HTTPS

https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/4/22/16a45839ceacbb52~tplv-t2oaga2asx-watermark.awebp

HTTP的问题

*  明文通信，内容可能被窃听 
*  无法验证内容完整性，内容可能被修改 
*  不知道通信方的身份，可能遭遇伪装 

HTTPS = HTTP + SSL/TLS

信息加密

*  对称加密DES（数据加密标准）、AES（高级加密标准）（快） 
*  非对称加密RSA、DSA（慢） 
*  HTTPS采用对称加密和非对称加密，解决了数据泄露问题 

完整性校验

https://juejin.cn/post/6844903830916694030

* 数字签名、摘要算法 
  * 将消息哈希生成消息摘要，用私钥加密生成数字签名，将消息和数字前面发给另一方。另一方用公钥解密生成消息摘要，将消息用哈希生成消息摘要。比较两个摘要
  * 例如MD5，或者加盐的MD5
  * SHA-1、SHA-2

身份验证

* 数字证书 
  * 加密密文
  * 散列算法
  * 证书内容


HTTPS：用非对称加密来加密对称加密的密钥